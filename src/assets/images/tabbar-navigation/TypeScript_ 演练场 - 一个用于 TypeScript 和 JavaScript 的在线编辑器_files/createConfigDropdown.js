define(["require", "exports"], function (require, exports) {
    "use strict";
    Object.defineProperty(exports, "__esModule", { value: true });
    exports.setupJSONToggleForConfig = exports.updateConfigDropdownForCompilerOptions = exports.createConfigDropdown = void 0;
    const notCompilerOptions = ["Project_Files_0", "Watch_Options_999", "Command_line_Options_6171"];
    const notRelevantToPlayground = [
        "listFiles",
        "allowJs",
        "checkJs",
        "explainFiles",
        "diagnostics",
        "extendedDiagnostics",
        "traceResolution",
        "assumeChangesOnlyAffectDirectDependencies",
        "emitDeclarationOnly",
        "resolveJsonModule",
        "skipDefaultLibCheck",
        "emitBOM",
        "noEmit",
        "disableSizeLimit",
        "disableReferencedProjectLoad",
        "disableSolutionSearching",
        "listEmittedFiles",
        "incremental",
        "composite",
        "sourceMap",
        "declarationMap",
        "preserveSymlinks",
        "noResolve",
        "noEmitOnError",
        "skipLibCheck",
        "forceConsistentCasingInFileNames",
    ];
    const createConfigDropdown = (sandbox, monaco) => {
        const configContainer = document.getElementById("config-container");
        const container = document.createElement("div");
        container.id = "boolean-options-container";
        configContainer.appendChild(container);
        // @ts-ignore
        const allOptions = sandbox.ts.optionDeclarations;
        const boolOptions = allOptions.filter(k => !notRelevantToPlayground.includes(k.name) &&
            k.type === "boolean" &&
            !k.isCommandLineOnly &&
            k.category &&
            !notCompilerOptions.includes(k.category.key));
        // We want to make sections of categories
        const categoryMap = {};
        boolOptions.forEach(opt => {
            let summary = optionsSummary.find(sum => opt.name === sum.id);
            // When a new compiler flag is added, and it isn't in the site yet, this lookup will fail.
            // Then re-create one from the info in the compiler
            if (!summary) {
                summary = {
                    display: opt.name,
                    oneliner: opt.description.message,
                    id: opt.name,
                    categoryDisplay: opt.category.message,
                    categoryID: opt.category.key,
                };
            }
            const existingCategory = categoryMap[summary.categoryID];
            if (!existingCategory)
                categoryMap[summary.categoryID] = {};
            categoryMap[summary.categoryID][opt.name] = summary;
        });
        const sortList = [
            "Strict_Type_Checking_Options_6173",
            "Additional_Checks_6176",
            "Basic_Options_6172",
            "Module_Resolution_Options_6174",
            "Source_Map_Options_6175",
            "Experimental_Options_6177",
            "Advanced_Options_6178",
        ];
        Object.keys(categoryMap)
            .sort((a, b) => sortList.indexOf(a) - sortList.indexOf(b))
            .forEach(categoryID => {
            const categoryDiv = document.createElement("div");
            const header = document.createElement("h4");
            const ol = document.createElement("ol");
            Object.keys(categoryMap[categoryID]).forEach(optID => {
                const optSummary = categoryMap[categoryID][optID];
                header.textContent = optSummary.categoryDisplay;
                const li = document.createElement("li");
                const label = document.createElement("label");
                label.style.position = "relative";
                label.style.width = "100%";
                const svg = `<?xml version="1.0" encoding="UTF-8"?><svg width="20px" height="20px" viewBox="0 0 20 20" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
          <g stroke="none" stroke-width="1" fill="none" fill-rule="evenodd">
            <circle stroke="#0B6F57" cx="10" cy="10" r="9"></circle>
            <path d="M9.99598394,6 C10.2048193,6 10.4243641,5.91700134 10.6546185,5.75100402 C10.8848728,5.58500669 11,5.33601071 11,5.00401606 C11,4.66666667 10.8848728,4.41499331 10.6546185,4.24899598 C10.4243641,4.08299866 10.2048193,4 9.99598394,4 C9.79250335,4 9.57563588,4.08299866 9.34538153,4.24899598 C9.11512718,4.41499331 9,4.66666667 9,5.00401606 C9,5.33601071 9.11512718,5.58500669 9.34538153,5.75100402 C9.57563588,5.91700134 9.79250335,6 9.99598394,6 Z M10.6877323,16 L10.6877323,14.8898836 L10.6877323,8 L9.30483271,8 L9.30483271,9.11011638 L9.30483271,16 L10.6877323,16 Z" fill="#0B6F57" fill-rule="nonzero"></path>
          </g>
      </svg>`;
                label.innerHTML = `<span>${optSummary.id}</span><a href='../tsconfig#${optSummary.id}' class='compiler_info_link' alt='Look up ${optSummary.id} in the TSConfig Reference' target='_blank'>${svg}</a><br/>${optSummary.oneliner}`;
                const input = document.createElement("input");
                input.value = optSummary.id;
                input.type = "checkbox";
                input.name = optSummary.id;
                input.id = "option-" + optSummary.id;
                input.onchange = () => {
                    sandbox.updateCompilerSetting(optSummary.id, input.checked);
                };
                label.htmlFor = input.id;
                li.appendChild(input);
                li.appendChild(label);
                ol.appendChild(li);
            });
            categoryDiv.appendChild(header);
            categoryDiv.appendChild(ol);
            container.appendChild(categoryDiv);
        });
        const dropdownContainer = document.getElementById("compiler-dropdowns");
        const target = optionsSummary.find(sum => sum.id === "target");
        const targetSwitch = createSelect(target.display, "target", target.oneliner, sandbox, sandbox.ts.ScriptTarget);
        dropdownContainer.appendChild(targetSwitch);
        const jsx = optionsSummary.find(sum => sum.id === "jsx");
        const jsxSwitch = createSelect(jsx.display, "jsx", jsx.oneliner, sandbox, sandbox.ts.JsxEmit);
        dropdownContainer.appendChild(jsxSwitch);
        // When switching between a .ts and a .tsx file - refresh the playground
        const internalSwitch = jsxSwitch.getElementsByTagName("select")[0];
        internalSwitch.addEventListener("change", () => {
            const isNowJSX = internalSwitch.selectedIndex !== 0;
            const isJSX = sandbox.filepath.endsWith("x");
            if (isNowJSX !== isJSX) {
                const newURL = sandbox.createURLQueryWithCompilerOptions(sandbox);
                window.history.replaceState({}, "", newURL);
                setTimeout(() => document.location.reload(), 300);
            }
        });
        const modSum = optionsSummary.find(sum => sum.id === "module");
        const moduleSwitch = createSelect(modSum.display, "module", modSum.oneliner, sandbox, sandbox.ts.ModuleKind);
        dropdownContainer.appendChild(moduleSwitch);
    };
    exports.createConfigDropdown = createConfigDropdown;
    const updateConfigDropdownForCompilerOptions = (sandbox, monaco) => {
        const compilerOpts = sandbox.getCompilerOptions();
        const boolOptions = Object.keys(compilerOpts).filter(k => typeof compilerOpts[k] === "boolean");
        boolOptions.forEach(opt => {
            if (notRelevantToPlayground.includes(opt))
                return;
            const inputID = "option-" + opt;
            const input = document.getElementById(inputID);
            if (!input)
                console.error("Could not find an input for", opt);
            else
                input.checked = !!compilerOpts[opt];
        });
        const compilerIDToMaps = {
            module: monaco.languages.typescript.ModuleKind,
            jsx: monaco.languages.typescript.JsxEmit,
            target: monaco.languages.typescript.ScriptTarget,
        };
        Object.keys(compilerIDToMaps).forEach(flagID => {
            const input = document.getElementById("compiler-select-" + flagID);
            const currentValue = compilerOpts[flagID];
            const map = compilerIDToMaps[flagID];
            // @ts-ignore
            const realValue = map[currentValue];
            if (!realValue)
                return;
            // @ts-ignore
            for (const option of input.children) {
                option.selected = option.value.toLowerCase() === realValue.toLowerCase();
            }
        });
    };
    exports.updateConfigDropdownForCompilerOptions = updateConfigDropdownForCompilerOptions;
    const createSelect = (title, id, blurb, sandbox, option) => {
        const label = document.createElement("label");
        const textToDescribe = document.createElement("span");
        textToDescribe.textContent = title + ":";
        label.appendChild(textToDescribe);
        const select = document.createElement("select");
        select.id = "compiler-select-" + id;
        label.appendChild(select);
        select.onchange = () => {
            const value = select.value; // the human string
            const compilerIndex = option[value];
            sandbox.updateCompilerSetting(id, compilerIndex);
        };
        Object.keys(option)
            .filter(key => isNaN(Number(key)))
            .forEach(key => {
            // hide Latest
            if (key === "Latest")
                return;
            const option = document.createElement("option");
            option.value = key;
            option.text = key;
            select.appendChild(option);
        });
        const span = document.createElement("span");
        span.innerHTML = blurb;
        span.classList.add("compiler-flag-blurb");
        label.appendChild(span);
        return label;
    };
    const setupJSONToggleForConfig = (sandbox) => { };
    exports.setupJSONToggleForConfig = setupJSONToggleForConfig;
});
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiY3JlYXRlQ29uZmlnRHJvcGRvd24uanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi8uLi8uLi9wbGF5Z3JvdW5kL3NyYy9jcmVhdGVDb25maWdEcm9wZG93bi50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOzs7O0lBc0JBLE1BQU0sa0JBQWtCLEdBQUcsQ0FBQyxpQkFBaUIsRUFBRSxtQkFBbUIsRUFBRSwyQkFBMkIsQ0FBQyxDQUFBO0lBQ2hHLE1BQU0sdUJBQXVCLEdBQUc7UUFDOUIsV0FBVztRQUNYLFNBQVM7UUFDVCxTQUFTO1FBQ1QsY0FBYztRQUNkLGFBQWE7UUFDYixxQkFBcUI7UUFDckIsaUJBQWlCO1FBQ2pCLDJDQUEyQztRQUMzQyxxQkFBcUI7UUFDckIsbUJBQW1CO1FBQ25CLHFCQUFxQjtRQUNyQixTQUFTO1FBQ1QsUUFBUTtRQUNSLGtCQUFrQjtRQUNsQiw4QkFBOEI7UUFDOUIsMEJBQTBCO1FBQzFCLGtCQUFrQjtRQUNsQixhQUFhO1FBQ2IsV0FBVztRQUNYLFdBQVc7UUFDWCxnQkFBZ0I7UUFDaEIsa0JBQWtCO1FBQ2xCLFdBQVc7UUFDWCxlQUFlO1FBQ2YsY0FBYztRQUNkLGtDQUFrQztLQUNuQyxDQUFBO0lBRU0sTUFBTSxvQkFBb0IsR0FBRyxDQUFDLE9BQWdCLEVBQUUsTUFBYyxFQUFFLEVBQUU7UUFDdkUsTUFBTSxlQUFlLEdBQUcsUUFBUSxDQUFDLGNBQWMsQ0FBQyxrQkFBa0IsQ0FBRSxDQUFBO1FBQ3BFLE1BQU0sU0FBUyxHQUFHLFFBQVEsQ0FBQyxhQUFhLENBQUMsS0FBSyxDQUFDLENBQUE7UUFDL0MsU0FBUyxDQUFDLEVBQUUsR0FBRywyQkFBMkIsQ0FBQTtRQUMxQyxlQUFlLENBQUMsV0FBVyxDQUFDLFNBQVMsQ0FBQyxDQUFBO1FBRXRDLGFBQWE7UUFDYixNQUFNLFVBQVUsR0FBc0IsT0FBTyxDQUFDLEVBQUUsQ0FBQyxrQkFBa0IsQ0FBQTtRQUVuRSxNQUFNLFdBQVcsR0FBRyxVQUFVLENBQUMsTUFB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QUFNLENBQUMsSUFBSSxHQUFHLEdBQUcsQ0FBQTtZQUVqQixNQUFNLENBQUMsV0FBVyxDQUFDLE1BQU0sQ0FBQyxDQUFBO1FBQzVCLENBQUMsQ0FBQyxDQUFBO1FBRUosTUFBTSxJQUFJLEdBQUcsUUFBUSxDQUFDLGFBQWEsQ0FBQyxNQUFNLENBQUMsQ0FBQTtRQUMzQyxJQUFJLENBQUMsU0FBUyxHQUFHLEtBQUssQ0FBQTtRQUN0QixJQUFJLENBQUMsU0FBUyxDQUFDLEdBQUcsQ0FBQyxxQkFBcUIsQ0FBQyxDQUFBO1FBQ3pDLEtBQUssQ0FBQyxXQUFXLENBQUMsSUFBSSxDQUFDLENBQUE7UUFFdkIsT0FBTyxLQUFLLENBQUE7SUFDZCxDQUFDLENBQUE7SUFFTSxNQUFNLHdCQUF3QixHQUFHLENBQUMsT0FBZ0IsRUFBRSxFQUFFLEdBQUcsQ0FBQyxDQUFBO0lBQXBELFFBQUEsd0JBQXdCLDRCQUE0QiIsInNvdXJjZXNDb250ZW50IjpbInR5cGUgU2FuZGJveCA9IGltcG9ydChcIkB0eXBlc2NyaXB0L3NhbmRib3hcIikuU2FuZGJveFxudHlwZSBNb25hY28gPSB0eXBlb2YgaW1wb3J0KFwibW9uYWNvLWVkaXRvclwiKVxuXG50eXBlIE9wdGlvbnNTdW1tYXJ5ID0ge1xuICBkaXNwbGF5OiBzdHJpbmdcbiAgb25lbGluZXI6IHN0cmluZ1xuICBpZDogc3RyaW5nXG4gIGNhdGVnb3J5SUQ6IHN0cmluZ1xuICBjYXRlZ29yeURpc3BsYXk6IHN0cmluZ1xufVxuXG4vLyBUaGlzIGlzIHdoZXJlIGFsbCB0aGUgbG9jYWxpemVkIGRlc2NyaXB0aW9ucyBjb21lIGZyb21cbmRlY2xhcmUgY29uc3Qgb3B0aW9uc1N1bW1hcnk6IE9wdGlvbnNTdW1tYXJ5W11cblxudHlwZSBDb21waWxlck9wdFN0dWIgPSB7XG4gIG5hbWU6IHN0cmluZ1xuICB0eXBlOiBzdHJpbmdcbiAgaXNDb21tYW5kTGluZU9ubHk6IGJvb2xlYW5cbiAgY2F0ZWdvcnk6IGFueVxuICBkZXNjcmlwdGlvbjogYW55XG59XG5cbmNvbnN0IG5vdENvbXBpbGVyT3B0aW9ucyA9IFtcIlByb2plY3RfRmlsZXNfMFwiLCBcIldhdGNoX09wdGlvbnNfOTk5XCIsIFwiQ29tbWFuZF9saW5lX09wdGlvbnNfNjE3MVwiXVxuY29uc3Qgbm90UmVsZXZhbnRUb1BsYXlncm91bmQgPSBbXG4gIFwibGlzdEZpbGVzXCIsXG4gIFwiYWxsb3dKc1wiLFxuICBcImNoZWNrSnNcIixcbiAgXCJleHBsYWluRmlsZXNcIixcbiAgXCJkaWFnbm9zdGljc1wiLFxuICBcImV4dGVuZGVkRGlhZ25vc3RpY3NcIixcbiAgXCJ0cmFjZVJlc29sdXRpb25cIixcbiAgXCJhc3N1bWVDaGFuZ2VzT25seUFmZmVjdERpcmVjdERlcGVuZGVuY2llc1wiLFxuICBcImVtaXREZWNsYXJhdGlvbk9ubHlcIixcbiAgXCJyZXNvbHZlSnNvbk1vZHVsZVwiLFxuICBcInNraXBEZWZhdWx0TGliQ2hlY2tcIixcbiAgXCJlbWl0Qk9NXCIsXG4gIFwibm9FbWl0XCIsXG4gIFwiZGlzYWJsZVNpemVMaW1pdFwiLFxuICBcImRpc2FibGVSZWZlcmVuY2VkUHJvamVjdExvYWRcIixcbiAgXCJkaXNhYmxlU29sdXRpb25TZWFyY2hpbmdcIixcbiAgXCJsaXN0RW1pdHRlZEZpbGVzXCIsXG4gIFwiaW5jcmVtZW50YWxcIixcbiAgXCJjb21wb3NpdGVcIixcbiAgXCJzb3VyY2VNYXBcIixcbiAgXCJkZWNsYXJhdGlvbk1hcFwiLFxuICBcInByZXNlcnZlU3ltbGlua3NcIixcbiAgXCJub1Jlc29sdmVcIixcbiAgXCJub0VtaXRPbkVycm9yXCIsXG4gIFwic2tpcExpYkNoZWNrXCIsXG4gIFwiZm9yY2VDb25zaXN0ZW50Q2FzaW5nSW5GaWxlTmFtZXNcIixcbl1cblxuZXhwb3J0IGNvbnN0IGNyZWF0ZUNvbmZpZ0Ryb3Bkb3duID0gKHNhbmRib3g6IFNhbmRib3gsIG1vbmFjbzogTW9uYWNvKSA9PiB7XG4gIGNvbnN0IGNvbmZpZ0NvbnRhaW5lciA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKFwiY29uZmlnLWNvbnRhaW5lclwiKSFcbiAgY29uc3QgY29udGFpbmVyID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcImRpdlwiKVxuICBjb250YWluZXIuaWQgPSBcImJvb2xlYW4tb3B0aW9ucy1jb250YWluZXJcIlxuICBjb25maWdDb250YWluZXIuYXBwZW5kQ2hpbGQoY29udGFpbmVyKVxuXG4gIC8vIEB0cy1pZ25vcmVcbiAgY29uc3QgYWxsT3B0aW9uczogQ29tcGlsZXJPcHRTdHViW10gPSBzYW5kYm94LnRzLm9wdGlvbkRlY2xhcmF0aW9uc1xuXG4gIGNvbnN0IGJvb2xPcHRpb25zID0gYWxsT3B0aW9ucy5maWx0ZXIoXG4gICAgayA9PlxuICAgICAgIW5vdFJlbGV2YW50VG9QbGF5Z3JvdW5kLmluY2x1ZGVzKGsubmFtZSkgJiZcbiAgICAgIGsudHlwZSA9PT0gXCJib29sZWFuXCIgJiZcbiAgICAgICFrLmlzQ29tbWFuZExpbmVPbmx5ICYmXG4gICAgICBrLmNhdGVnb3J5ICYmXG4gICAgICAhbm90Q29tcGlsZXJPcHRpb25zLmluY2x1ZGVzKGsuY2F0ZWdvcnkua2V5KVxuICApXG5cbiAgLy8gV2Ugd2FudCB0byBtYWtlIHNlY3Rpb25zIG9mIGNhdGVnb3JpZXNcbiAgY29uc3QgY2F0ZWdvcnlNYXAgPSB7fSBhcyB7IFtjYXRlZ29yeTogc3RyaW5nXTogeyBbb3B0SUQ6IHN0cmluZ106IE9wdGlvbnNTdW1tYXJ5IH0gfVxuICBib29sT3B0aW9ucy5mb3JFYWNoKG9wdCA9PiB7XG4gICAgbGV0IHN1bW1hcnkgPSBvcHRpb25zU3VtbWFyeS5maW5kKHN1bSA9PiBvcHQubmFtZSA9PT0gc3VtLmlkKSFcblxuICAgIC8vIFdoZW4gYSBuZXcgY29tcGlsZXIgZmxhZyBpcyBhZGRlZCwgYW5kIGl0IGlzbid0IGluIHRoZSBzaXRlIHlldCwgdGhpcyBsb29rdXAgd2lsbCBmYWlsLlxuICAgIC8vIFRoZW4gcmUtY3JlYXRlIG9uZSBmcm9tIHRoZSBpbmZvIGluIHRoZSBjb21waWxlclxuICAgIGlmICghc3VtbWFyeSkge1xuICAgICAgc3VtbWFyeSA9IHtcbiAgICAgICAgZGlzcGxheTogb3B0Lm5hbWUsXG4gICAgICAgIG9uZWxpbmVyOiBvcHQuZGVzY3JpcHRpb24ubWVzc2FnZSxcbiAgICAgICAgaWQ6IG9wdC5uYW1lLFxuICAgICAgICBjYXRlZ29yeURpc3BsYXk6IG9wdC5jYXRlZ29yeS5tZXNzYWdlLFxuICAgICAgICBjYXRlZ29yeUlEOiBvcHQuY2F0ZWdvcnkua2V5LFxuICAgICAgfVxuICAgIH1cblxuICAgIGNvbnN0IGV4aXN0aW5nQ2F0ZWdvcnkgPSBjYXRlZ29yeU1hcFtzdW1tYXJ5LmNhdGVnb3J5SURdXG4gICAgaWYgKCFleGlzdGluZ0NhdGVnb3J5KSBjYXRlZ29yeU1hcFtzdW1tYXJ5LmNhdGVnb3J5SURdID0ge31cblxuICAgIGNhdGVnb3J5TWFwW3N1bW1hcnkuY2F0ZWdvcnlJRF1bb3B0Lm5hbWVdID0gc3VtbWFyeVxuICB9KVxuXG4gIGNvbnN0IHNvcnRMaXN0ID0gW1xuICAgIFwiU3RyaWN0X1R5cGVfQ2hlY2tpbmdfT3B0aW9uc182MTczXCIsXG4gICAgXCJBZGRpdGlvbmFsX0NoZWNrc182MTc2XCIsXG4gICAgXCJCYXNpY19PcHRpb25zXzYxNzJcIixcbiAgICBcIk1vZHVsZV9SZXNvbHV0aW9uX09wdGlvbnNfNjE3NFwiLFxuICAgIFwiU291cmNlX01hcF9PcHRpb25zXzYxNzVcIixcbiAgICBcIkV4cGVyaW1lbnRhbF9PcHRpb25zXzYxNzdcIixcbiAgICBcIkFkdmFuY2VkX09wdGlvbnNfNjE3OFwiLFxuICBdXG5cbiAgT2JqZWN0LmtleXMoY2F0ZWdvcnlNYXApXG4gICAgLnNvcnQoKGEsIGIpID0+IHNvcnRMaXN0LmluZGV4T2YoYSkgLSBzb3J0TGlzdC5pbmRleE9mKGIpKVxuICAgIC5mb3JFYWNoKGNhdGVnb3J5SUQgPT4ge1xuICAgICAgY29uc3QgY2F0ZWdvcnlEaXYgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwiZGl2XCIpXG4gICAgICBjb25zdCBoZWFkZXIgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwiaDRcIilcbiAgICAgIGNvbnN0IG9sID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcIm9sXCIpXG5cbiAgICAgIE9iamVjdC5rZXlzKGNhdGVnb3J5TWFwW2NhdGVnb3J5SURdKS5mb3JFYWNoKG9wdElEID0+IHtcbiAgICAgICAgY29uc3Qgb3B0U3VtbWFyeSA9IGNhdGVnb3J5TWFwW2NhdGVnb3J5SURdW29wdElEXVxuICAgICAgICBoZWFkZXIudGV4dENvbnRlbnQgPSBvcHRTdW1tYXJ5LmNhdGVnb3J5RGlzcGxheVxuXG4gICAgICAgIGNvbnN0IGxpID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcImxpXCIpXG4gICAgICAgIGNvbnN0IGxhYmVsID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcImxhYmVsXCIpXG4gICAgICAgIGxhYmVsLnN0eWxlLnBvc2l0aW9uID0gXCJyZWxhdGl2ZVwiXG4gICAgICAgIGxhYmVsLnN0eWxlLndpZHRoID0gXCIxMDAlXCJcblxuICAgICAgICBjb25zdCBzdmcgPSBgPD94bWwgdmVyc2lvbj1cIjEuMFwiIGVuY29kaW5nPVwiVVRGLThcIj8+PHN2ZyB3aWR0aD1cIjIwcHhcIiBoZWlnaHQ9XCIyMHB4XCIgdmlld0JveD1cIjAgMCAyMCAyMFwiIHZlcnNpb249XCIxLjFcIiB4bWxucz1cImh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnXCIgeG1sbnM6eGxpbms9XCJodHRwOi8vd3d3LnczLm9yZy8xOTk5L3hsaW5rXCI+XG4gICAgICAgICAgPGcgc3Ryb2tlPVwibm9uZVwiIHN0cm9rZS13aWR0aD1cIjFcIiBmaWxsPVwibm9uZVwiIGZpbGwtcnVsZT1cImV2ZW5vZGRcIj5cbiAgICAgICAgICAgIDxjaXJjbGUgc3Ryb2tlPVwiIzBCNkY1N1wiIGN4PVwiMTBcIiBjeT1cIjEwXCIgcj1cIjlcIj48L2NpcmNsZT5cbiAgICAgICAgICAgIDxwYXRoIGQ9XCJNOS45OTU5ODM5NCw2IEMxMC4yMDQ4MTkzLDYgMTAuNDI0MzY0MSw1LjkxNzAwMTM0IDEwLjY1NDYxODUsNS43NTEwMDQwMiBDMTAuODg0ODcyOCw1LjU4NTAwNjY5IDExLDUuMzM2MDEwNzEgMTEsNS4wMDQwMTYwNiBDMTEsNC42NjY2NjY2NyAxMC44ODQ4NzI4LDQuNDE0OTkzMzEgMTAuNjU0NjE4NSw0LjI0ODk5NTk4IEMxMC40MjQzNjQxLDQuMDgyOTk4NjYgMTAuMjA0ODE5Myw0IDkuOTk1OTgzOTQsNCBDOS43OTI1MDMzNSw0IDkuNTc1NjM1ODgsNC4wODI5OTg2NiA5LjM0NTM4MTUzLDQuMjQ4OTk1OTggQzkuMTE1MTI3MTgsNC40MTQ5OTMzMSA5LDQuNjY2NjY2NjcgOSw1LjAwNDAxNjA2IEM5LDUuMzM2MDEwNzEgOS4xMTUxMjcxOCw1LjU4NTAwNjY5IDkuMzQ1MzgxNTMsNS43NTEwMDQwMiBDOS41NzU2MzU4OCw1LjkxNzAwMTM0IDkuNzkyNTAzMzUsNiA5Ljk5NTk4Mzk0LDYgWiBNMTAuNjg3NzMyMywxNiBMMTAuNjg3NzMyMywxNC44ODk4ODM2IEwxMC42ODc3MzIzLDggTDkuMzA0ODMyNzEsOCBMOS4zMDQ4MzI3MSw5LjExMDExNjM4IEw5LjMwNDgzMjcxLDE2IEwxMC42ODc3MzIzLDE2IFpcIiBmaWxsPVwiIzBCNkY1N1wiIGZpbGwtcnVsZT1cIm5vbnplcm9cIj48L3BhdGg+XG4gICAgICAgICAgPC9nPlxuICAgICAgPC9zdmc+YFxuICAgICAgICBsYWJlbC5pbm5lckhUTUwgPSBgPHNwYW4+JHtvcHRTdW1tYXJ5LmlkfTwvc3Bhbj48YSBocmVmPScuLi90c2NvbmZpZyMke29wdFN1bW1hcnkuaWR9JyBjbGFzcz0nY29tcGlsZXJfaW5mb19saW5rJyBhbHQ9J0xvb2sgdXAgJHtvcHRTdW1tYXJ5LmlkfSBpbiB0aGUgVFNDb25maWcgUmVmZXJlbmNlJyB0YXJnZXQ9J19ibGFuayc+JHtzdmd9PC9hPjxici8+JHtvcHRTdW1tYXJ5Lm9uZWxpbmVyfWBcblxuICAgICAgICBjb25zdCBpbnB1dCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJpbnB1dFwiKVxuICAgICAgICBpbnB1dC52YWx1ZSA9IG9wdFN1bW1hcnkuaWRcbiAgICAgICAgaW5wdXQudHlwZSA9IFwiY2hlY2tib3hcIlxuICAgICAgICBpbnB1dC5uYW1lID0gb3B0U3VtbWFyeS5pZFxuICAgICAgICBpbnB1dC5pZCA9IFwib3B0aW9uLVwiICsgb3B0U3VtbWFyeS5pZFxuXG4gICAgICAgIGlucHV0Lm9uY2hhbmdlID0gKCkgPT4ge1xuICAgICAgICAgIHNhbmRib3gudXBkYXRlQ29tcGlsZXJTZXR0aW5nKG9wdFN1bW1hcnkuaWQsIGlucHV0LmNoZWNrZWQpXG4gICAgICAgIH1cblxuICAgICAgICBsYWJlbC5odG1sRm9yID0gaW5wdXQuaWRcblxuICAgICAgICBsaS5hcHBlbmRDaGlsZChpbnB1dClcbiAgICAgICAgbGkuYXBwZW5kQ2hpbGQobGFiZWwpXG4gICAgICAgIG9sLmFwcGVuZENoaWxkKGxpKVxuICAgICAgfSlcblxuICAgICAgY2F0ZWdvcnlEaXYuYXBwZW5kQ2hpbGQoaGVhZGVyKVxuICAgICAgY2F0ZWdvcnlEaXYuYXBwZW5kQ2hpbGQob2wpXG4gICAgICBjb250YWluZXIuYXBwZW5kQ2hpbGQoY2F0ZWdvcnlEaXYpXG4gICAgfSlcblxuICBjb25zdCBkcm9wZG93bkNvbnRhaW5lciA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKFwiY29tcGlsZXItZHJvcGRvd25zXCIpIVxuXG4gIGNvbnN0IHRhcmdldCA9IG9wdGlvbnNTdW1tYXJ5LmZpbmQoc3VtID0+IHN1bS5pZCA9PT0gXCJ0YXJnZXRcIikhXG4gIGNvbnN0IHRhcmdldFN3aXRjaCA9IGNyZWF0ZVNlbGVjdCh0YXJnZXQuZGlzcGxheSwgXCJ0YXJnZXRcIiwgdGFyZ2V0Lm9uZWxpbmVyLCBzYW5kYm94LCBzYW5kYm94LnRzLlNjcmlwdFRhcmdldClcbiAgZHJvcGRvd25Db250YWluZXIuYXBwZW5kQ2hpbGQodGFyZ2V0U3dpdGNoKVxuXG4gIGNvbnN0IGpzeCA9IG9wdGlvbnNTdW1tYXJ5LmZpbmQoc3VtID0+IHN1bS5pZCA9PT0gXCJqc3hcIikhXG4gIGNvbnN0IGpzeFN3aXRjaCA9IGNyZWF0ZVNlbGVjdChqc3guZGlzcGxheSwgXCJqc3hcIiwganN4Lm9uZWxpbmVyLCBzYW5kYm94LCBzYW5kYm94LnRzLkpzeEVtaXQpXG4gIGRyb3Bkb3duQ29udGFpbmVyLmFwcGVuZENoaWxkKGpzeFN3aXRjaClcblxuICAvLyBXaGVuIHN3aXRjaGluZyBiZXR3ZWVuIGEgLnRzIGFuZCBhIC50c3ggZmlsZSAtIHJlZnJlc2ggdGhlIHBsYXlncm91bmRcbiAgY29uc3QgaW50ZXJuYWxTd2l0Y2ggPSBqc3hTd2l0Y2guZ2V0RWxlbWVudHNCeVRhZ05hbWUoXCJzZWxlY3RcIilbMF1cbiAgaW50ZXJuYWxTd2l0Y2guYWRkRXZlbnRMaXN0ZW5lcihcImNoYW5nZVwiLCAoKSA9PiB7XG4gICAgY29uc3QgaXNOb3dKU1ggPSBpbnRlcm5hbFN3aXRjaC5zZWxlY3RlZEluZGV4ICE9PSAwXG4gICAgY29uc3QgaXNKU1ggPSBzYW5kYm94LmZpbGVwYXRoLmVuZHNXaXRoKFwieFwiKVxuICAgIGlmIChpc05vd0pTWCAhPT0gaXNKU1gpIHtcbiAgICAgIGNvbnN0IG5ld1VSTCA9IHNhbmRib3guY3JlYXRlVVJMUXVlcnlXaXRoQ29tcGlsZXJPcHRpb25zKHNhbmRib3gpXG4gICAgICB3aW5kb3cuaGlzdG9yeS5yZXBsYWNlU3RhdGUoe30sIFwiXCIsIG5ld1VSTClcbiAgICAgIHNldFRpbWVvdXQoKCkgPT4gZG9jdW1lbnQubG9jYXRpb24ucmVsb2FkKCksIDMwMClcbiAgICB9XG4gIH0pXG5cbiAgY29uc3QgbW9kU3VtID0gb3B0aW9uc1N1bW1hcnkuZmluZChzdW0gPT4gc3VtLmlkID09PSBcIm1vZHVsZVwiKSFcbiAgY29uc3QgbW9kdWxlU3dpdGNoID0gY3JlYXRlU2VsZWN0KG1vZFN1bS5kaXNwbGF5LCBcIm1vZHVsZVwiLCBtb2RTdW0ub25lbGluZXIsIHNhbmRib3gsIHNhbmRib3gudHMuTW9kdWxlS2luZClcbiAgZHJvcGRvd25Db250YWluZXIuYXBwZW5kQ2hpbGQobW9kdWxlU3dpdGNoKVxufVxuXG5leHBvcnQgY29uc3QgdXBkYXRlQ29uZmlnRHJvcGRvd25Gb3JDb21waWxlck9wdGlvbnMgPSAoc2FuZGJveDogU2FuZGJveCwgbW9uYWNvOiBNb25hY28pID0+IHtcbiAgY29uc3QgY29tcGlsZXJPcHRzID0gc2FuZGJveC5nZXRDb21waWxlck9wdGlvbnMoKVxuICBjb25zdCBib29sT3B0aW9ucyA9IE9iamVjdC5rZXlzKGNvbXBpbGVyT3B0cykuZmlsdGVyKGsgPT4gdHlwZW9mIGNvbXBpbGVyT3B0c1trXSA9PT0gXCJib29sZWFuXCIpXG5cbiAgYm9vbE9wdGlvbnMuZm9yRWFjaChvcHQgPT4ge1xuICAgIGlmIChub3RSZWxldmFudFRvUGxheWdyb3VuZC5pbmNsdWRlcyhvcHQpKSByZXR1cm5cblxuICAgIGNvbnN0IGlucHV0SUQgPSBcIm9wdGlvbi1cIiArIG9wdFxuICAgIGNvbnN0IGlucHV0ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoaW5wdXRJRCkgYXMgSFRNTElucHV0RWxlbWVudFxuICAgIGlmICghaW5wdXQpIGNvbnNvbGUuZXJyb3IoXCJDb3VsZCBub3QgZmluZCBhbiBpbnB1dCBmb3JcIiwgb3B0KVxuICAgIGVsc2UgaW5wdXQuY2hlY2tlZCA9ICEhY29tcGlsZXJPcHRzW29wdF1cbiAgfSlcblxuICBjb25zdCBjb21waWxlcklEVG9NYXBzOiBhbnkgPSB7XG4gICAgbW9kdWxlOiBtb25hY28ubGFuZ3VhZ2VzLnR5cGVzY3JpcHQuTW9kdWxlS2luZCxcbiAgICBqc3g6IG1vbmFjby5sYW5ndWFnZXMudHlwZXNjcmlwdC5Kc3hFbWl0LFxuICAgIHRhcmdldDogbW9uYWNvLmxhbmd1YWdlcy50eXBlc2NyaXB0LlNjcmlwdFRhcmdldCxcbiAgfVxuXG4gIE9iamVjdC5rZXlzKGNvbXBpbGVySURUb01hcHMpLmZvckVhY2goZmxhZ0lEID0+IHtcbiAgICBjb25zdCBpbnB1dCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKFwiY29tcGlsZXItc2VsZWN0LVwiICsgZmxhZ0lEKSBhcyBIVE1MSW5wdXRFbGVtZW50XG4gICAgY29uc3QgY3VycmVudFZhbHVlID0gY29tcGlsZXJPcHRzW2ZsYWdJRF1cbiAgICBjb25zdCBtYXAgPSBjb21waWxlcklEVG9NYXBzW2ZsYWdJRF1cbiAgICAvLyBAdHMtaWdub3JlXG4gICAgY29uc3QgcmVhbFZhbHVlID0gbWFwW2N1cnJlbnRWYWx1ZV1cbiAgICBpZiAoIXJlYWxWYWx1ZSkgcmV0dXJuXG5cbiAgICAvLyBAdHMtaWdub3JlXG4gICAgZm9yIChjb25zdCBvcHRpb24gb2YgaW5wdXQuY2hpbGRyZW4pIHtcbiAgICAgIG9wdGlvbi5zZWxlY3RlZCA9IG9wdGlvbi52YWx1ZS50b0xvd2VyQ2FzZSgpID09PSByZWFsVmFsdWUudG9Mb3dlckNhc2UoKVxuICAgIH1cbiAgfSlcbn1cblxuY29uc3QgY3JlYXRlU2VsZWN0ID0gKHRpdGxlOiBzdHJpbmcsIGlkOiBzdHJpbmcsIGJsdXJiOiBzdHJpbmcsIHNhbmRib3g6IFNhbmRib3gsIG9wdGlvbjogYW55KSA9PiB7XG4gIGNvbnN0IGxhYmVsID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcImxhYmVsXCIpXG4gIGNvbnN0IHRleHRUb0Rlc2NyaWJlID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcInNwYW5cIilcbiAgdGV4dFRvRGVzY3JpYmUudGV4dENvbnRlbnQgPSB0aXRsZSArIFwiOlwiXG4gIGxhYmVsLmFwcGVuZENoaWxkKHRleHRUb0Rlc2NyaWJlKVxuXG4gIGNvbnN0IHNlbGVjdCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJzZWxlY3RcIilcbiAgc2VsZWN0LmlkID0gXCJjb21waWxlci1zZWxlY3QtXCIgKyBpZFxuICBsYWJlbC5hcHBlbmRDaGlsZChzZWxlY3QpXG5cbiAgc2VsZWN0Lm9uY2hhbmdlID0gKCkgPT4ge1xuICAgIGNvbnN0IHZhbHVlID0gc2VsZWN0LnZhbHVlIC8vIHRoZSBodW1hbiBzdHJpbmdcbiAgICBjb25zdCBjb21waWxlckluZGV4ID0gb3B0aW9uW3ZhbHVlXVxuICAgIHNhbmRib3gudXBkYXRlQ29tcGlsZXJTZXR0aW5nKGlkLCBjb21waWxlckluZGV4KVxuICB9XG5cbiAgT2JqZWN0LmtleXMob3B0aW9uKVxuICAgIC5maWx0ZXIoa2V5ID0+IGlzTmFOKE51bWJlcihrZXkpKSlcbiAgICAuZm9yRWFjaChrZXkgPT4ge1xuICAgICAgLy8gaGlkZSBMYXRlc3RcbiAgICAgIGlmIChrZXkgPT09IFwiTGF0ZXN0XCIpIHJldHVyblxuXG4gICAgICBjb25zdCBvcHRpb24gPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwib3B0aW9uXCIpXG4gICAgICBvcHRpb24udmFsdWUgPSBrZXlcbiAgICAgIG9wdGlvbi50ZXh0ID0ga2V5XG5cbiAgICAgIHNlbGVjdC5hcHBlbmRDaGlsZChvcHRpb24pXG4gICAgfSlcblxuICBjb25zdCBzcGFuID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcInNwYW5cIilcbiAgc3Bhbi5pbm5lckhUTUwgPSBibHVyYlxuICBzcGFuLmNsYXNzTGlzdC5hZGQoXCJjb21waWxlci1mbGFnLWJsdXJiXCIpXG4gIGxhYmVsLmFwcGVuZENoaWxkKHNwYW4pXG5cbiAgcmV0dXJuIGxhYmVsXG59XG5cbmV4cG9ydCBjb25zdCBzZXR1cEpTT05Ub2dnbGVGb3JDb25maWcgPSAoc2FuZGJveDogU2FuZGJveCkgPT4geyB9XG4iXX0=