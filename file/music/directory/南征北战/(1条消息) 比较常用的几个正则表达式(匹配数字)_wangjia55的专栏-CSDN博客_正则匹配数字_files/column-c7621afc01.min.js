$(function(){function a(){h="https://csdnimg.cn/release/download/images/pay_error.png",w="已扫码<br>请在手机端操作",$("#payCode").html('<div class="renovate"><img src="'+h+'"><span>'+w+"</span></div>"),$("#payCodeImg").html('<img class="repeat-again" src="'+h+'"><span class="text">'+w+"</span>")}function e(e){var n={goods_id:e,product_id:e,flag:17,request_type:4,is_use_balance:r,coupon_key:y,success_function:s,error_function:o,timeout_function:i,get_pay_success_callback:t,payment_function:a};$("#payCode").html(_),$("#payCodeImg").html(k),cart.qrPay(n)}function s(a,e){v?d("payCode",e.pay_url):d("payCodeImg",e.pay_url),u=e.pay_url}function t(){f.boxshadow.fadeOut(function(){showToast({text:"支付成功",bottom:"10%",zindex:9e3,speed:500,time:1500}),window.location.reload(),f.payCode.fadeOut(function(){window.location.reload()})})}function o(a){showToast({text:a.errorMessage,bottom:"10%",zindex:9e3,speed:500,time:1500})}function i(){v?f.payCode.find("#payCode").html(C):f.getPay.find("#payCodeImg").html(I)}function n(a,e){var s=Number(a)-Number(e);return s>0?s.toFixed(2):s<0?s.toFixed(2):s}function c(a){$.ajax({type:"GET",url:"https://mall.csdn.net/mp/mallorder/api/internal/goods/getGoodsInfo?goods_id="+a+"&product_id="+a+"&flag=17",xhrFields:{withCredentials:!0},crossDomain:!0,success:function(s){p=s.data.available_amount,s.data.coupon_discount&&s.data.coupon_key&&(m=1*s.data.coupon_discount,y=s.data.coupon_key),P++,P<=1&&(0==p?(r=0,$(".pay-code-radio").prop("disabled",!0)):n(O,m)>0?(r=1,$(".pay-code-radio").attr("data-flag","true"),$(".pay-code-radio").prop("checked",!0)):(r=0,$(".pay-code-radio").prop("disabled",!0))),$(".pay-balance .balance").text(p),$(".pay-code-balance .balance").text(p),l(),e(a)}})}function l(){$(".subscribe-available-balance .subscribe-available-balance-t").css({display:"block"}),m?(n(O,m)>0?r?(n(n(O,m),p)>0?($(".available-balance-0").text("¥"+p),$(".available-balance-1").text("¥"+n(n(O,m),p))):($(".available-balance-0").text("¥"+n(O,m)),$(".available-balance-1").text("¥0")),$(".subscribe-price-box").css({display:"none"}),$(".subscribe-available-balance").css({display:"block"})):($(".available-balance-1").text("¥"+n(O,m)),$(".subscribe-price-box").css({display:"none"}),$(".subscribe-available-balance .subscribe-available-balance-t").css({display:"none"}),$(".subscribe-available-balance").css({display:"block"})):($(".available-balance-1").text("¥0"),$(".subscribe-price-box").css({display:"none"}),$(".subscribe-available-balance .subscribe-available-balance-t").css({display:"none"}),$(".subscribe-available-balance").css({display:"block"})),$(".coupons-box .coupons-money").html("¥"+m),$(".coupons-box").fadeIn()):r?(n(O,p)>0?($(".available-balance-0").text("¥"+p),$(".available-balance-1").text("¥"+n(O,p))):($(".available-balance-0").text("¥"+O),$(".available-balance-1").text("¥0")),$(".subscribe-price-box").css({display:"none"}),$(".subscribe-available-balance").css({display:"block"})):($(".now-price").text("¥"+O),$(".subscribe-available-balance").css({display:"none"}),$(".subscribe-price-box").css({display:"block"}))}function d(a,e){var s=qrcode(6,"M");s.addData(e),s.make(),$("#"+a).html(s.createImgTag(3,3)),$("#"+a).html($("#"+a).html()),v&&f.boxshadow.fadeIn(function(){f.payCode.fadeIn()})}function b(){var a=$(this),e=a.data("id");if(a.data("type"))var s=blogUrl+"phoenix/web/v1/subscribe/un-subscribe-study?columnId="+e;else var s=blogUrl+"phoenix/web/v1/subscribe/subscribe-study?columnId="+e;getCookie("UserName")?$.ajax({url:s,type:"post",dataType:"json",xhrFields:{withCredentials:!0},success:function(e){200==e.code&&e.data.status?a.data("type")?($(".studyvip-unsubscribe").css("display","inline-block"),$(".studyvip-subscribe").css("display","none")):($(".studyvip-subscribe").css("display","inline-block"),$(".studyvip-unsubscribe").css("display","none")):showToast({text:e.data.msg||"操作失败，请重试！",bottom:"10%",zindex:9e3,speed:500,time:1500})},error:function(a){showToast({text:a.data.msg||"操作失败，请重试！",bottom:"10%",zindex:9e3,speed:500,time:1500})}}):window.csdn.loginBox.show()}var r=0,p=0,u="",y="",m=0;$(document).on("click",".tip-subscribe-column>span",function(){$(this).parent().find(".tip").fadeIn()}),$(document).on("click",".tip-subscribe-column .bt-close",function(){$(".tip-subscribe-column").find(".tip").fadeOut()});var g="",f={boxshadow:$(".skin-boxshadow"),btClose:$(".bt-close"),payCode:$(".pay-code"),btSubscribe:$(".bt-subscribe-article"),btSubscribeColumn:$(".bt-subscribe-text"),getPay:$(".get-pay")},v=!1,x=window.location.href;x.indexOf("category_")>-1&&!v&&getCookie("UserName")&&f.getPay.length&&(g=f.getPay.data("id"),c(g)),$(document).on("click",".bt-subscribe",function(){getCookie("UserName")||window.csdn.loginBox.show()}),f.getPay.on("click",function(){v=!1,g=$(this).data("id"),e(g)}),f.payCode.on("click",".renovate",function(){e(g||$(this).parent().data("id"))}),f.btClose.on("click",function(){f.payCode.fadeOut(function(){f.boxshadow.fadeOut()})});var h=blogStaticHost+"dist/pc/img/pay-time-out.png",w="获取中",k='<img class="repeat-again" src="'+h+'"><span class="text">'+w+"</span>",_='<div class="renov-men"><img src="'+h+'"><span>'+w+"</span></div>",C='<div class="renovate">    <img src="'+blogStaticHost+'dist/pc/img/pay-time-out.png">    <span>点击重新获取</span></div>',I='<img class="repeat-again" src="'+blogStaticHost+'dist/pc/img/pay-time-out.png"><span class="text">点击重新获取</span>';$(".now-price").text();$(".pay-code-radio").click(function(){var a=$(this).attr("data-flag");"true"==a?(r=0,$(this).attr("data-flag","false"),$(this).prop("checked",!1)):(r=1,$(this).attr("data-flag","true"),$(this).prop("checked",!0)),c(g)});var O=$(".subscribe-price .now-price").text().slice(1),P=0;f.payCode.on("click",".blance-bt",function(){window.open(u)}),$(document).on("click",".articleColumnBt",function(){if(getCookie("UserName")){if(window.csdn&&window.csdn.userOrderPayment){var a=$(this).data("id");window.csdn.userOrderPayment.show({goods_id:a,product_id:a,flag:17})}}else window.csdn.loginBox.show()}),$(document).on("click",".column-studyvip-pass",function(){getCookie("UserName")?window.open("https://vip.csdn.net/studyvip?utm_source=zhuanlan"):window.csdn.loginBox.show()}),$(document).on("click",".column-studyvip-ajax",b)});